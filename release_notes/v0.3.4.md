# PiPinPP v0.3.4 - Arduino Utility Functions (Random, Bits & Bytes)

**Release Date:** November 5, 2025  
**Type:** Patch Release (Backward Compatible)

---

## ðŸŽ¯ Overview

This patch release completes Arduino's core utility function compatibility by adding **random number generation**, **bit manipulation**, and **byte extraction** functions. All functions are Arduino-compatible with zero overhead inline implementations where appropriate.

All changes are **100% backward compatible** with v0.3.3.

---

## âœ¨ New Features

### Random Number Functions

Generate pseudo-random numbers with Arduino-compatible API.

#### `randomSeed(seed)`
Initialize the random number generator with a seed value.

**Implementation:** Uses C++ `<random>` library with Mersenne Twister engine (std::mt19937)

```cpp
#include <ArduinoCompat.hpp>

void setup() {
    randomSeed(micros());  // Seed with current time
}

void loop() {
    int value = random(100);  // Random 0-99
    delay(1000);
}
```

**Features:**
- Thread-safe with mutex protection
- High-quality Mersenne Twister PRNG
- Arduino-compatible API
- Perfect for animations and effects

---

#### `random(max)`
Generate random number in range [0, max).

**Returns:** `long` - Random value from 0 up to (but not including) max

```cpp
#include <ArduinoCompat.hpp>

// Simulate dice roll
int dice = random(6) + 1;  // Returns 1-6

// Random LED brightness
int brightness = random(256);  // Returns 0-255

// Random delay
int delayMs = random(100, 500);  // Returns 100-499
```

**Features:**
- Uniform distribution
- Thread-safe
- Excludes max value (matches Arduino)

---

#### `random(min, max)`
Generate random number in range [min, max).

**Returns:** `long` - Random value from min up to (but not including) max

```cpp
#include <ArduinoCompat.hpp>

// Random temperature simulation
int temp = random(20, 30);  // 20-29Â°C

// Random servo angle
int angle = random(0, 180);  // 0-179 degrees

// Random blink pattern
int blinks = random(3, 8);  // 3-7 blinks
```

**Use Cases:**
- LED patterns and effects
- Sensor simulation
- Game mechanics
- Random delays

---

### Bit Manipulation Functions

Efficient inline functions for bit-level operations.

#### `bit(n)`
Compute the value of bit at position n (2^n).

**Returns:** `unsigned long` - Value with bit n set (1 << n)

```cpp
unsigned long mask = bit(4);  // Returns 16 (0b00010000)
unsigned long flags = bit(0) | bit(3) | bit(7);  // Multiple bits
```

---

#### `bitRead(x, n)`
Read the value of bit n from value x.

**Returns:** `unsigned long` - 1 if bit is set, 0 if clear

```cpp
unsigned long flags = 0b10110100;
bool isSet = bitRead(flags, 5);    // Returns 1 (bit 5 is set)
bool isClear = bitRead(flags, 0);  // Returns 0 (bit 0 is clear)
```

---

#### `bitWrite(x, n, b)`
Set or clear bit n in value x.

```cpp
unsigned long flags = 0;
bitWrite(flags, 3, 1);  // Set bit 3: flags = 0b00001000
bitWrite(flags, 3, 0);  // Clear bit 3: flags = 0b00000000
```

---

#### `bitSet(x, n)`
Set bit n to 1.

```cpp
unsigned long flags = 0b00000000;
bitSet(flags, 2);  // flags = 0b00000100
bitSet(flags, 5);  // flags = 0b00100100
```

---

#### `bitClear(x, n)`
Clear bit n to 0.

```cpp
unsigned long flags = 0b11111111;
bitClear(flags, 2);  // flags = 0b11111011
bitClear(flags, 5);  // flags = 0b11011011
```

**Features:**
- All inline functions (zero runtime overhead)
- Perfect for status flags
- Hardware register manipulation
- Protocol implementation

---

### Byte Extraction Functions

Extract high and low bytes from 16-bit values.

#### `highByte(x)`
Extract high-order byte (bits 8-15) from 16-bit word.

**Returns:** `unsigned char` - High byte

```cpp
unsigned int value = 0xABCD;
unsigned char high = highByte(value);  // Returns 0xAB
```

---

#### `lowByte(x)`
Extract low-order byte (bits 0-7) from 16-bit word.

**Returns:** `unsigned char` - Low byte

```cpp
unsigned int value = 0xABCD;
unsigned char low = lowByte(value);  // Returns 0xCD
```

**Use Cases:**
- Splitting sensor data for transmission
- I2C/SPI protocol implementation
- Network byte order conversion
- Multi-byte value handling

**Example - Sensor Data Transmission:**
```cpp
// Read 16-bit sensor value
unsigned int sensorValue = 2567;  // 25.67Â°C * 100

// Split for transmission
unsigned char highData = highByte(sensorValue);  // 0x0A
unsigned char lowData = lowByte(sensorValue);    // 0x07

// Transmit bytes...
i2c.write(highData);
i2c.write(lowData);

// Reconstruct on receiver
unsigned int reconstructed = ((unsigned int)highData << 8) | lowData;
// reconstructed == 2567 âœ“
```

---

### Character Classification Functions

**Note:** Arduino's character classification functions (`isAlpha`, `isDigit`, `isSpace`, etc.) are already available in C++ standard library `<cctype>`.

We **don't provide wrappers** to avoid naming conflicts when users write `using namespace std;`.

**Arduino code:**
```cpp
if (isAlpha(ch)) { ... }
```

**PiPinPP code:**
```cpp
#include <cctype>
if (std::isalpha(ch)) { ... }
```

**Available functions in `<cctype>`:**
- `std::isalpha(ch)` - Check if alphabetic
- `std::isdigit(ch)` - Check if digit
- `std::isspace(ch)` - Check if whitespace
- `std::isalnum(ch)` - Check if alphanumeric
- `std::isupper(ch)` - Check if uppercase
- `std::islower(ch)` - Check if lowercase
- `std::isxdigit(ch)` - Check if hexadecimal digit
- `std::ispunct(ch)` - Check if punctuation
- `std::isprint(ch)` - Check if printable
- `std::iscntrl(ch)` - Check if control character
- `std::isgraph(ch)` - Check if graphical character

This approach avoids conflicts while maintaining compatibility with standard C++.

---

## ðŸ“š Comprehensive Example: `utility_functions`

We've added a **461-line comprehensive example** demonstrating all new utility functions:

### Demonstration 1: Random Number Generation
- Random numbers in different ranges
- Dice roll simulation with distribution chart
- Random LED pattern generation
- Random delay values for effects

### Demonstration 2: Bit Manipulation
- Computing bit values with visual binary output
- Reading individual bits from values
- Setting and clearing bits
- Modifying specific bits with bitWrite()
- Visual tables showing binary representations

### Demonstration 3: Byte Extraction
- Extracting high/low bytes from 16-bit values
- Practical sensor data transmission example
- Reconstructing values from bytes
- Complete with formatted tables

### Demonstration 4: Practical Applications
- Device status flags management
- Random LED blink patterns
- Real-world use cases

**Run the example:**
```bash
cd PiPinPP/build
./examples/example_utility_functions
```

---

## ðŸ”„ Migration Guide

**No migration needed!** This is a **100% backward compatible** patch release.

All existing code continues to work exactly as before. The new functions are purely additive.

### Adding Utility Functions to Your Project

**Before (No utilities):**
```cpp
#include <pin.hpp>

int main() {
    Pin led(17, PinDirection::OUTPUT);
    led.write(true);
    return 0;
}
```

**After (With utilities):**
```cpp
#include <ArduinoCompat.hpp>

int main() {
    randomSeed(micros());
    
    Pin led(17, PinDirection::OUTPUT);
    
    // Random blink pattern
    for (int i = 0; i < 10; i++) {
        int delayMs = random(100, 500);
        led.write(true);
        delay(delayMs);
        led.write(false);
        delay(delayMs);
    }
    
    return 0;
}
```

---

## ðŸ“¦ Installation

### Quick Install (Recommended)
```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.4/install.sh | sudo bash
```

### Manual Installation
```bash
git clone https://github.com/Barbatos6669/PiPinPP.git
cd PiPinPP
git checkout v0.3.4
./build.sh
cd build
sudo make install
```

### Update from Previous Version
```bash
cd PiPinPP
git pull origin main
git checkout v0.3.4
./build.sh
cd build
sudo make install
```

Or use the one-line reinstall:
```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.4/install.sh | sudo bash
```

---

## ðŸ§ª Testing

All **40 unit tests pass** with 100% success rate:
- âœ… 8 timing tests
- âœ… 11 exception handling tests
- âœ… 18 Pin operation tests
- âœ… 3 legacy tests

Build tested on:
- âœ… Raspberry Pi OS Trixie (Debian 13)
- âœ… libgpiod 2.2.1
- âœ… GCC 14.2.0 with `-Wall -Wextra -Wpedantic -Werror`
- âœ… CMake 3.31.6

---

## ðŸ“š Documentation

Complete documentation available:
- **API Reference:** [docs/API_REFERENCE.md](docs/API_REFERENCE.md)
- **Build Guide:** [BUILD.md](BUILD.md)
- **Install Guide:** [INSTALL.md](INSTALL.md)
- **Changelog:** [CHANGELOG.md](CHANGELOG.md)
- **Roadmap:** [docs/planning/ROADMAP.md](docs/planning/ROADMAP.md)

---

## ðŸ“Š Statistics

- **New Functions:** 10 (randomSeed, randomÃ—2, bitÃ—5, byteÃ—2)
- **Total Arduino Functions:** 29 (19 from v0.3.3 + 10 new)
- **New Example:** utility_functions (461 lines, 4 demonstrations)
- **Examples:** 13 comprehensive examples
- **Lines of Code:** 3,160+ (core library + examples)
- **Documentation:** Complete with practical examples
- **Test Coverage:** 40/40 tests passing (100%)
- **Supported Platforms:** Raspberry Pi 4/5 with Raspberry Pi OS Trixie

---

## ðŸŽ¯ Arduino API Completion Status

### âœ… Implemented (as of v0.3.4)

**Digital I/O:**
- pinMode(), digitalWrite(), digitalRead()
- HIGH, LOW, INPUT, OUTPUT, INPUT_PULLUP

**Timing:**
- millis(), micros(), delay(), delayMicroseconds()

**Math:**
- constrain(), map(), sq()
- DEG_TO_RAD, RAD_TO_DEG constants

**Random:**
- random(), randomSeed()

**Bits & Bytes:**
- bit(), bitRead(), bitWrite(), bitSet(), bitClear()
- highByte(), lowByte()

**Interrupts:**
- attachInterrupt(), detachInterrupt()

**PWM:**
- analogWrite()

**Pin Queries:**
- isOutput(), isInput(), getMode(), digitalToggle()

### ðŸ“‹ Coming in v0.4.0

- I2C/Wire support
- SPI support
- Serial/UART support
- Hardware PWM
- Advanced I/O functions

---

## ðŸ™ Contributors

- **HobbyHacker / Barbatos6669** - Implementation, testing, and documentation

---

## ðŸ“‹ Full Changelog

See [CHANGELOG.md](../CHANGELOG.md) for complete details.

---

## ðŸ”® What's Next?

### v0.4.0 (Planned Q1 2026)
Major feature release with communication protocols:
- **I2C/Wire API** - Complete Wire library compatibility
- **SPI API** - Complete SPI library compatibility
- **Serial/UART API** - Complete Serial library compatibility
- **Hardware PWM** - Native hardware PWM support
- **Advanced I/O** - pulseIn(), shiftIn(), shiftOut(), tone()

See [docs/planning/ROADMAP.md](../docs/planning/ROADMAP.md) for the full development plan.

---

## ðŸ’¬ Feedback & Support

- **Issues:** [GitHub Issues](https://github.com/Barbatos6669/PiPinPP/issues)
- **Discussions:** [GitHub Discussions](https://github.com/Barbatos6669/PiPinPP/discussions)
- **Documentation:** [GitHub Wiki](https://github.com/Barbatos6669/PiPinPP/wiki)
- **Discord:** [Join PiPin++ Discord](https://discord.gg/wXeZP8Ev)

---

## ðŸ“„ License

MIT License - See [LICENSE](../LICENSE) file for details.

---

**Thank you for using PiPinPP!** ðŸŽ‰

If you find this library useful, please â­ **star the repository** and share it with the Raspberry Pi and Arduino communities!

---

## ðŸ”— Quick Links

- **Repository:** https://github.com/Barbatos6669/PiPinPP
- **Latest Release:** https://github.com/Barbatos6669/PiPinPP/releases/tag/v0.3.4
- **Installation Script:** https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.4/install.sh
- **Documentation:** https://github.com/Barbatos6669/PiPinPP/tree/main/docs
- **Examples:** https://github.com/Barbatos6669/PiPinPP/tree/main/examples
- **API Docs:** https://barbatos6669.github.io/PiPinPP/
