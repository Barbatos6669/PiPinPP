# PiPinPP v0.3.6 Release Notes

**Release Date:** November 5, 2025  
**Type:** Feature Release (Minor Update)

## ðŸŽ‰ What's New

Version 0.3.6 adds **Advanced I/O functions** for interfacing with sensors and peripherals. These Arduino-inspired functions make it easy to work with ultrasonic sensors, shift registers, and audio buzzers without writing custom bit-banging code.

---

## âœ¨ New Features

### Advanced I/O Functions

Five new functions for sensor and peripheral interfacing:

#### 1. Pulse Width Measurement

```cpp
unsigned long pulseIn(int pin, bool state, unsigned long timeout = 1000000);
unsigned long pulseInLong(int pin, bool state, unsigned long timeout = 1000000);
```

**Perfect for:**
- HC-SR04 ultrasonic distance sensors
- IR receivers and remote controls
- Frequency measurement
- PWM signal reading

**Features:**
- High-precision timing (Â±10Âµs accuracy)
- Configurable timeout (default 1 second)
- Automatic INPUT pin configuration
- Returns duration in microseconds (0 on timeout)

**Example:**
```cpp
// Measure distance with HC-SR04
digitalWrite(TRIG_PIN, HIGH);
delayMicroseconds(10);
digitalWrite(TRIG_PIN, LOW);

unsigned long duration = pulseIn(ECHO_PIN, HIGH, 30000);
float distance_cm = duration * 0.034 / 2.0;
```

#### 2. Shift Register Communication

```cpp
void shiftOut(int dataPin, int clockPin, int bitOrder, unsigned char value);
unsigned char shiftIn(int dataPin, int clockPin, int bitOrder);
constexpr int LSBFIRST = 0;
constexpr int MSBFIRST = 1;
```

**Perfect for:**
- 74HC595 shift registers (output expansion)
- 74HC165 shift registers (input expansion)
- LED matrices and 7-segment displays
- Button/switch banks
- SPI-like communication

**Features:**
- Expand GPIO: Control 8+ pins with just 2-3 GPIOs
- Support for LSB-first or MSB-first bit order
- Auto-configures pins (OUTPUT/INPUT as needed)
- Can cascade multiple chips (16, 24, 32+ pins)
- ~1MHz clock speed

**Example - Control 8 LEDs:**
```cpp
const int DATA_PIN = 17;
const int CLOCK_PIN = 27;
const int LATCH_PIN = 22;

pinMode(LATCH_PIN, OUTPUT);
digitalWrite(LATCH_PIN, LOW);
shiftOut(DATA_PIN, CLOCK_PIN, MSBFIRST, 0b10101010);  // Alternating pattern
digitalWrite(LATCH_PIN, HIGH);
```

**Example - Read 8 Buttons:**
```cpp
const int DATA_PIN = 17;
const int CLOCK_PIN = 27;
const int LOAD_PIN = 22;

digitalWrite(LOAD_PIN, LOW);
delayMicroseconds(5);
digitalWrite(LOAD_PIN, HIGH);

unsigned char buttons = shiftIn(DATA_PIN, CLOCK_PIN, MSBFIRST);
if (buttons & (1 << 0)) {
    // Button 0 is pressed
}
```

#### 3. Tone Generation

```cpp
void tone(int pin, unsigned int frequency, unsigned long duration = 0);
void noTone(int pin);
```

**Perfect for:**
- Piezo buzzers
- Small speakers
- Alarms and notifications
- Musical instruments
- Audio feedback
- Morse code

**Features:**
- Frequency range: 31Hz - 65,535Hz
- Optional duration parameter (milliseconds)
- 50% duty cycle square wave
- Uses existing PWM system
- Automatic pin configuration
- Non-blocking (unless duration specified)

**Example - Simple Beep:**
```cpp
tone(17, 1000);      // 1kHz tone
delay(500);          // Play for 500ms
noTone(17);          // Stop
```

**Example - Play Melody:**
```cpp
// "Mary Had a Little Lamb"
int melody[] = {330, 294, 262, 294, 330, 330, 330};  // E D C D E E E
int durations[] = {250, 250, 250, 250, 250, 250, 500};

for (int i = 0; i < 7; i++) {
    tone(17, melody[i], durations[i]);
    delay(durations[i] * 1.3);  // Add gap between notes
}
```

**Example - Alarm Sound:**
```cpp
for (int i = 0; i < 10; i++) {
    tone(17, 800, 100);   // High beep
    delay(150);
    tone(17, 400, 100);   // Low beep
    delay(150);
}
```

---

## ðŸ“š New Documentation

### Comprehensive Example

**`examples/advanced_io/main.cpp`** - 600+ line demonstration featuring:
- Complete usage examples for all new functions
- Ultrasonic sensor simulation with distance calculations
- LED patterns with shift registers (74HC595)
- Button matrix reading (74HC165)
- Musical note generation examples
- Visual tables and ASCII diagrams
- Real-world application ideas

Run it:
```bash
./build/examples/example_advanced_io
```

### Updated Documentation

- **TODO.md** - Marked completed features from v0.3.1-v0.3.4
  - Extended Math (sq, DEG_TO_RAD, RAD_TO_DEG)
  - Random Numbers (random, randomSeed)
  - Bits & Bytes (bit operations)
  - Character functions (documented std:: usage)
  - Pin queries (isOutput, isInput, getMode, digitalToggle)

---

## ðŸ”§ Technical Details

### Implementation Quality

- **All tests passing:** 40/40 (100%)
- **Zero warnings:** Clean build with `-Wall -Wextra -Wpedantic -Werror`
- **Documentation:** ~200 lines of comprehensive Doxygen comments
- **Code:** ~180 lines of implementation
- **Thread-safe:** All functions use proper locking
- **Error handling:** Validates parameters and handles edge cases

### Performance

- **pulseIn():** Â±10Âµs timing accuracy using `std::chrono::steady_clock`
- **shiftOut/In():** ~1MHz clock rate with 1Âµs delays
- **tone():** Uses existing PWM infrastructure, no additional overhead

### Compatibility

- **Arduino API:** 95%+ compatible with Arduino's Advanced I/O functions
- **Platform:** Raspberry Pi 4/5, Raspberry Pi OS Trixie (Debian 13)
- **C++ Standard:** C++17
- **libgpiod:** v2.2.1

---

## ðŸ“¦ Installation

### Quick Install (Recommended)

```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.6/install.sh | sudo bash
```

### Update from v0.3.5

```bash
cd PiPinPP
git fetch
git checkout v0.3.6
./build.sh
cd build
sudo make install
sudo ldconfig
```

### Verify Installation

```bash
pkg-config --modversion pipinpp  # Should show: 0.3.6
```

---

## ðŸŽ¯ Use Cases

### Robotics
- Ultrasonic distance sensors for obstacle avoidance
- Shift registers for controlling multiple motors/servos
- Audio feedback for status indicators

### Home Automation
- Button banks for control panels (shift register inputs)
- LED status indicators (shift register outputs)
- Doorbells and alarms (tone generation)

### Education
- Distance measurement experiments
- Digital logic demonstrations
- Simple musical instruments

### Data Acquisition
- Pulse width measurement for sensors
- Frequency counting
- Signal timing analysis

---

## ðŸ”„ Migration from v0.3.5

**No breaking changes!** This is a pure feature addition. All existing code continues to work unchanged.

### New Headers

All new functions are in `<ArduinoCompat.hpp>`:
```cpp
#include <ArduinoCompat.hpp>

// New functions automatically available
unsigned long duration = pulseIn(17, HIGH);
shiftOut(17, 27, MSBFIRST, 0xFF);
tone(22, 1000, 500);
```

---

## ðŸ“Š Statistics

### Code Changes
- **Files changed:** 5
- **Lines added:** 860+
- **New functions:** 5
- **New constants:** 2
- **New example:** 1 (600+ lines)

### Test Coverage
- **Total tests:** 40
- **Pass rate:** 100%
- **Test time:** <1 second

### Documentation
- **Doxygen comments:** ~200 lines
- **Example code:** 600+ lines
- **Release notes:** This document!

---

## ðŸ› Known Issues

None at this time! All features tested and working.

---

## ðŸš€ What's Next?

### Planned for v0.3.7+
- I2C communication (Wire library)
- SPI communication
- UART/Serial communication
- Hardware PWM support
- More sensor examples

See [ROADMAP.md](../ROADMAP.md) for complete future plans.

---

## ðŸ™ Acknowledgments

Thanks to the Arduino community for the API inspiration, and to everyone using PiPinPP in their projects!

---

## ðŸ“– Additional Resources

- **Getting Started:** [docs/GETTING_STARTED.md](../docs/GETTING_STARTED.md)
- **API Reference:** [docs/API_REFERENCE.md](../docs/API_REFERENCE.md)
- **Troubleshooting:** [docs/TROUBLESHOOTING.md](../docs/TROUBLESHOOTING.md)
- **Examples:** [examples/](../examples/)
- **GitHub:** https://github.com/Barbatos6669/PiPinPP

---

**Full Changelog:** [CHANGELOG.md](../CHANGELOG.md)

**Questions or issues?** Open an issue on GitHub or check our [FAQ](../docs/FAQ.md)!
