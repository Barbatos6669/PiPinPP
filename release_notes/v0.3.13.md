# PiPinPP v0.3.13 Release Notes

**Release Date**: November 16, 2025

## ðŸŽ¯ Headline Feature: Hardware PWM Support

PiPinPP v0.3.13 introduces **Hardware PWM** support, completing the Arduino API compatibility mission! This release enables jitter-free PWM control for servo motors, ESCs, and precise timing applications using the Raspberry Pi's hardware PWM controller.

---

## âœ¨ What's New

### Hardware PWM (`HardwarePWM` class)

**Purpose**: Jitter-free PWM output via Linux `/sys/class/pwm` sysfs interface for applications requiring precise timing.

**Supported Pins:**
- GPIO12 (PWM0 channel 0)
- GPIO13 (PWM0 channel 1)
- GPIO18 (PWM0 channel 0)
- GPIO19 (PWM0 channel 1)

**Key Features:**
```cpp
#include "HardwarePWM.hpp"

HardwarePWM servo(0, 0);  // chip=0, channel=0 (GPIO18)
servo.begin(50, 7.5);      // 50Hz, 7.5% duty (servo center)

// Servo control (0-180Â°)
servo.setDutyCycle(5.0);   // 0Â° position
servo.setDutyCycle(7.5);   // 90Â° position
servo.setDutyCycle(10.0);  // 180Â° position

// Arduino-style 8-bit control
servo.setDutyCycle8Bit(0);     // 0% (LED off)
servo.setDutyCycle8Bit(127);   // 50% (half brightness)
servo.setDutyCycle8Bit(255);   // 100% (LED full)

// Nanosecond precision
servo.setPeriodNs(20000000);    // 20ms (50Hz)
servo.setDutyCycleNs(1500000);  // 1.5ms (servo center)
```

**API Methods:**
- `begin(frequencyHz, dutyCycle)` - Initialize PWM with frequency (1Hz-25MHz)
- `setFrequency()`, `setDutyCycle()`, `setDutyCycle8Bit()` - Runtime adjustments
- `setPeriodNs()`, `setDutyCycleNs()` - Nanosecond precision control
- `setPolarity(PWMPolarity)` - Normal or inversed output
- `enable()`, `disable()` - PWM output control
- `getFrequency()`, `getDutyCycle()`, `isEnabled()` - State queries
- `static gpioToPWM(gpio, chip, channel)` - Pin mapping helper

**Thread Safety**: Internal mutex protection for concurrent access.

---

## ðŸ“¦ New Examples

### 1. Servo Control (`examples/pwm_servo/`)

Demonstrates precise servo motor control with angle-to-pulse-width conversion:

```cpp
// Move servo through positions
for (int angle = 0; angle <= 180; angle += 10) {
    double pulseMs = angleToPulseWidth(angle);
    double duty = pulseWidthToDutyCycle(pulseMs);
    servo.setDutyCycle(duty);
    delay(100);
}
```

**Features:**
- Predefined positions (0Â°, 45Â°, 90Â°, 135Â°, 180Â°)
- Smooth sweep functions
- Micro-adjustments (1Â° increments)
- Speed control examples
- Includes servo wiring instructions

### 2. Hardware PWM LED Fading (`examples/pwm_led_hardware/`)

Flicker-free LED dimming with hardware PWM:

```cpp
// Breathing effect (sine wave)
for (int i = 0; i < 360; i++) {
    double radians = i * M_PI / 180.0;
    double brightness = (sin(radians) + 1.0) / 2.0;
    led.setDutyCycle(brightness * 100.0);
    delay(10);
}
```

**Features:**
- Linear fade effects
- Breathing effect (sine wave modulation)
- Pulse effects
- Frequency comparison tests (100Hz, 1kHz, 10kHz)

---

## ðŸ§ª Testing Improvements

**Test Coverage:**
- **175 tests** (up from 148 in v0.3.12)
- **+27 Hardware PWM tests** in `gtest_hardware_pwm.cpp`

**Test Categories:**
- âœ… API compliance (27 tests)
- âœ… Thread safety verification
- âœ… GPIO-to-PWM mapping validation
- âœ… 8-bit conversion accuracy
- âœ… Nanosecond calculation tests
- â­ï¸ Hardware tests (skipped without `/sys/class/pwm` access)

**All tests passing** with hardware tests properly skipped in CI environments.

---

## ðŸ“š Documentation Updates

### API Reference (`docs/API_REFERENCE.md`)
- New **Hardware PWM** section with complete API documentation
- Servo control patterns and examples
- Hardware vs Software PWM comparison guide
- GPIO pin mapping reference

### README.md
- Updated version badge: `v0.3.13`
- Updated test count: `175 passing`
- Added Hardware PWM to features list
- Removed "Hardware PWM" from future goals (now complete!)

### CHANGELOG.md
- Comprehensive v0.3.13 change documentation
- Migration notes for users

---

## ðŸš€ When to Use Hardware vs Software PWM

| Feature | Hardware PWM | Software PWM |
|---------|--------------|--------------|
| **Pins** | GPIO12/13/18/19 only | Any GPIO pin |
| **Jitter** | None (hardware-timed) | ~1-10Âµs (thread scheduling) |
| **Frequency Range** | 1Hz - 25MHz | Practical: 50Hz - 10kHz |
| **CPU Usage** | Minimal | 1 thread per pin |
| **Best For** | Servos, ESCs, motors, precise timing | LED dimming, multiple pins |
| **Thread Safety** | Mutex-protected | Mutex-protected |

**Rule of Thumb:**
- **Servo motors, ESCs, motor controllers** â†’ Use Hardware PWM (50Hz required, jitter-sensitive)
- **LED dimming, multiple pins** â†’ Use Software PWM (good enough, more flexible)

---

## ðŸ”§ Breaking Changes

**None!** This is a backward-compatible feature addition.

---

## ðŸ“¥ Installation

### Quick Install (One-Line)
```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.13/install.sh | sudo bash
```

### Update from Previous Version
```bash
cd /path/to/PiPinPP
git fetch origin
git checkout v0.3.13
./build.sh --clean
sudo make install -C build
```

### Verify Installation
```bash
pkg-config --modversion pipinpp
# Output: 0.3.13
```

---

## ðŸ› Bug Fixes

No bug fixes in this release (pure feature addition).

---

## ðŸ™ Contributors

- **Larry (Barbatos6669)** - Hardware PWM implementation, examples, tests, documentation

---

## ðŸ“‹ Full Changelog

See [CHANGELOG.md](../CHANGELOG.md) for complete change history.

---

## ðŸŽ‰ What's Next?

PiPinPP v0.3.13 achieves **full Arduino API compatibility** for Raspberry Pi! ðŸš€

**Future Plans (v0.4.0+):**
- Multi-platform support (Orange Pi, other ARM SBCs)
- Advanced features (analog input, GPIO monitoring tools)
- Development tools (VS Code extensions, debugging utilities)

---

## ðŸ’¬ Feedback

Have questions or suggestions? Open an issue on [GitHub](https://github.com/Barbatos6669/PiPinPP/issues) or start a discussion!

---

**Happy Making!** ðŸ¤–âœ¨
