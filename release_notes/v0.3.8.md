# PiPinPP v0.3.8 Release Notes

**Release Date**: November 8, 2025  
**Type**: Patch Release (Bugfix)  
**Note**: Historical release notes included in v0.3.11 PR for complete changelog.

## Overview

This is a critical bugfix release that resolves installation failures on fresh Raspberry Pi systems where libgpiod packages are unavailable in system repositories.

## üêõ Bug Fixes

### Installation Script Fix

**Issue**: The installation script would fail immediately if libgpiod packages (`libgpiod-dev`, `libgpiod2`, `gpiod`) were not available in the system package repositories. This affected most Raspberry Pi OS installations where these packages either don't exist or are too old (v1.x instead of required v2.x).

**Error encountered**:
```
E: Package 'libgpiod2' has no installation candidate
‚úó Failed to install dependencies
```

**Resolution**: Completely refactored the dependency installation logic in `install.sh`:

1. **Separated core dependencies from optional packages**
   - Core packages (build-essential, cmake, pkg-config, git) are installed first and must succeed
   - libgpiod packages are attempted separately and failures are handled gracefully

2. **Improved version detection**
   - Added explicit handling for "unknown" libgpiod version (not installed)
   - Added `NEEDS_BUILD` flag for clearer logic flow
   - Verifies backports installation before accepting it

3. **Enhanced source build fallback**
   - Better error handling at each build step (clone, configure, make, install)
   - Multiple kernel header package name attempts (linux-headers-generic, linux-headers-$(uname -r), raspberrypi-kernel-headers)
   - Post-build verification to ensure libgpiod v2.x installed correctly
   - Comprehensive progress messages throughout

**Impact**: The one-line installer now works reliably on all Raspberry Pi OS and Ubuntu installations, automatically building libgpiod v2.2.1 from source when system packages are unavailable or outdated.

## üì¶ Changes

- **Modified**: `install.sh` - Complete dependency installation refactor
- **Modified**: `CMakeLists.txt` - Version bump to 0.3.8
- **Modified**: `README.md` - Updated version badge and install URL
- **Modified**: `docs/API_REFERENCE.md` - Updated version and date

## üîÑ Upgrade Instructions

### New Installations

Use the updated one-line installer:

```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/v0.3.8/install.sh | sudo bash
```

### Existing Installations

No action required. This release only fixes the installation process; the library code is unchanged from v0.3.7. If you already have v0.3.7 installed, it will continue to work perfectly.

If you want to update to v0.3.8 for consistency:

```bash
cd /tmp
git clone --depth 1 --branch v0.3.8 https://github.com/Barbatos6669/PiPinPP.git
cd PiPinPP
cmake -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build
sudo cmake --install build
```

## ‚úÖ Verification

After installation, verify the version:

```bash
pkg-config --modversion pipinpp
# Should output: 0.3.8
```

## üìù Technical Details

### Before (v0.3.7 and earlier):
```bash
apt-get install -y -qq \
    build-essential \
    cmake \
    pkg-config \
    git \
    libgpiod-dev \      # If ANY of these fail...
    libgpiod2 \         # 
    gpiod \             #
    || {
        exit 1          # Script exits immediately
    }
```

### After (v0.3.8):
```bash
# Core dependencies (must succeed)
apt-get install -y -qq build-essential cmake pkg-config git || exit 1

# Optional libgpiod (can fail gracefully)
apt-get install -y -qq libgpiod-dev libgpiod2 gpiod 2>/dev/null || {
    print_warning "Could not install libgpiod from repositories"
}

# Check version and build from source if needed
if libgpiod missing or too old; then
    ‚Üí Try backports
    ‚Üí Build v2.2.1 from source with comprehensive error handling
    ‚Üí Verify installation succeeded
fi
```

## üôè Acknowledgments

Thanks to the community for reporting installation issues on fresh Raspberry Pi systems!

## üîó Links

- [Full Changelog](../CHANGELOG.md)
- [Installation Guide](../docs/INSTALL.md)
- [Troubleshooting](../docs/TROUBLESHOOTING.md)
- [GitHub Release](https://github.com/Barbatos6669/PiPinPP/releases/tag/v0.3.8)

---

**Previous Release**: [v0.3.7](v0.3.7.md) - SPI Support & Example READMEs  
**Next Release**: v0.4.0 - Hardware PWM & UART (Planned Q1 2026)
