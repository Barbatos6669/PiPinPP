# PiPinPP v0.3.1 - Pin State Query Functions

**Release Date:** November 4, 2025  
**Type:** Patch Release (Backward Compatible)

---

## üéØ Overview

This patch release adds **4 new Arduino-compatible functions** for querying and manipulating pin states, making it easier to check pin configurations and toggle outputs efficiently.

All new functions are **thread-safe**, **fully documented**, and **backward compatible** with v0.3.0.

---

## ‚ú® New Features

### Pin State Query Functions

#### `bool isOutput(int pin)`
Check if a pin is configured as OUTPUT.

```cpp
pinMode(17, OUTPUT);
if (isOutput(17)) {
    digitalToggle(17);  // Safe to toggle
}
```

**Features:**
- Returns `true` if pin is OUTPUT, `false` otherwise
- Thread-safe with mutex protection
- Throws `PinError` if pin not initialized

---

#### `bool isInput(int pin)`
Check if a pin is configured as any INPUT variant (INPUT, INPUT_PULLUP, INPUT_PULLDOWN).

```cpp
pinMode(18, INPUT_PULLUP);
if (isInput(18)) {
    int state = digitalRead(18);
}
```

**Features:**
- Returns `true` for INPUT, INPUT_PULLUP, or INPUT_PULLDOWN
- Useful for validating pin configuration before reading
- Thread-safe with mutex protection

---

#### `ArduinoPinMode getMode(int pin)`
Get the exact current mode of a pin.

```cpp
pinMode(17, OUTPUT);
ArduinoPinMode mode = getMode(17);
if (mode == OUTPUT) {
    digitalWrite(17, HIGH);
}
```

**Features:**
- Returns enum: `INPUT`, `OUTPUT`, `INPUT_PULLUP`, or `INPUT_PULLDOWN`
- Precise mode information for debugging
- Thread-safe with mutex protection

---

#### `void digitalToggle(int pin)`
Efficiently toggle an OUTPUT pin between HIGH and LOW.

```cpp
pinMode(17, OUTPUT);
digitalWrite(17, LOW);   // Start LOW

// Toggle LED rapidly
while (true) {
    digitalToggle(17);
    delay(500);
}
```

**Features:**
- **Much faster** than `digitalRead()` + `digitalWrite()`
- Internally tracks last written value (no hardware read needed)
- Validates write success and throws `GpioAccessError` on failure
- Only works on OUTPUT pins (throws `PinError` for INPUT)
- Thread-safe with mutex protection

---

## üîß Improvements

### INPUT_PULLDOWN Support
- Added `INPUT_PULLDOWN = 3` to `ArduinoPinMode` enum
- Full support in all pin query functions
- Updated documentation to mention all 4 pin modes
- Improved logging to distinguish INPUT_PULLDOWN from INPUT

### Error Handling
- `digitalToggle()` now validates write success
- Throws `GpioAccessError` if GPIO write fails
- Internal state remains consistent even on failures
- Better error messages with current pin mode information

### Documentation
- Complete API reference for all 4 new functions
- Added "Pin State Query Functions" section to docs
- Updated Table of Contents
- Practical usage examples for each function
- Updated CHANGELOG.md with detailed feature list

---

## üìä Statistics

- **New Functions:** 4
- **Total Arduino Functions:** 18 (was 14)
- **Lines of Code Added:** ~150
- **Documentation Pages Updated:** 4 (API_REFERENCE, CHANGELOG, TODO, README)
- **Test Coverage:** All 40 existing tests still passing

---

## üîÑ Migration Guide

**No migration needed!** This is a **100% backward compatible** patch release.

All existing code continues to work exactly as before. The new functions are purely additive.

### Optional: Take Advantage of New Features

**Before (v0.3.0):**
```cpp
// Toggle LED the old way
digitalWrite(17, !digitalRead(17));  // Requires read + write
```

**After (v0.3.1):**
```cpp
// Toggle LED the new way
digitalToggle(17);  // Much faster, no read needed!
```

---

## üì¶ Installation

### Quick Install (Recommended)
```bash
curl -sSL https://raw.githubusercontent.com/Barbatos6669/PiPinPP/main/install.sh | sudo bash
```

### Manual Installation
```bash
git clone https://github.com/Barbatos6669/PiPinPP.git
cd PiPinPP
git checkout v0.3.1
mkdir build && cd build
cmake ..
make -j$(nproc)
sudo make install
sudo ldconfig
```

### Update from v0.3.0
```bash
cd PiPinPP
git pull origin main
git checkout v0.3.1
cd build
cmake ..
make -j$(nproc)
sudo make install
sudo ldconfig
```

---

## üß™ Testing

All **40 unit tests pass** with 100% success rate:
- ‚úÖ 8 timing tests
- ‚úÖ 11 exception handling tests
- ‚úÖ 18 Pin operation tests
- ‚úÖ 3 legacy tests

Build tested on:
- ‚úÖ Raspberry Pi OS Trixie (Debian 13)
- ‚úÖ libgpiod 2.2.1
- ‚úÖ GCC 14.2.0 with `-Werror` (warnings as errors)
- ‚úÖ CMake 3.31.6

---

## üìö Documentation

Complete documentation available:
- **API Reference:** [docs/API_REFERENCE.md](docs/API_REFERENCE.md)
- **Changelog:** [CHANGELOG.md](CHANGELOG.md)
- **Project Status:** [PROJECT_STATUS.md](PROJECT_STATUS.md)
- **TODO List:** [TODO.md](TODO.md)

---

## üêõ Bug Fixes

- Fixed `digitalToggle()` to validate write success before updating internal state
- Fixed `pinMode()` logging to correctly report INPUT_PULLDOWN mode
- Updated documentation comments to mention INPUT_PULLDOWN support

---

## üôè Contributors

- **HobbyHacker / Barbatos6669** - Implementation, testing, and documentation

---

## üìã Full Changelog

See [CHANGELOG.md](CHANGELOG.md) for complete details.

---

## üîÆ What's Next?

### v0.4.0 (Planned Q1 2026)
Major feature release with communication protocols:
- I2C/Wire API (15+ functions)
- SPI API (12+ functions)
- Serial/UART API (20+ functions)
- Hardware PWM support
- Complete Arduino API compatibility

See [ROADMAP.md](ROADMAP.md) for the full development plan.

---

## üí¨ Feedback & Support

- **Issues:** [GitHub Issues](https://github.com/Barbatos6669/PiPinPP/issues)
- **Discussions:** [GitHub Discussions](https://github.com/Barbatos6669/PiPinPP/discussions)
- **Documentation:** [Wiki](https://github.com/Barbatos6669/PiPinPP/wiki)

---

## üìÑ License

MIT License - See [LICENSE](LICENSE) file for details.

---

**Thank you for using PiPinPP!** üéâ

If you find this library useful, please ‚≠ê star the repository and share it with the maker community!
